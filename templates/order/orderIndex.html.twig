{% extends 'base.html.twig' %}

{% block title %}Hello OrderController!{% endblock %}

{% block body %}
<style>
    .example-wrapper { margin: 1em auto; max-width: 800px; width: 95%; font: 18px/1.5 sans-serif; }
    .example-wrapper code { background: #F5F5F5; padding: 2px 6px; }
</style>

<div class="example-wrapper">
    <div class="container">
        <div class="row">
            <div class="col-8">
                <h1 class='mt-4 mb-4'>Commande</h1>
                 {{ form_start(form) }}
                    {{ form_widget(form) }}
                <input type="submit" value="Continuer" class="btn btn-outline-primary">
                {{ form_end(form) }}
            </div>
            <div class="col-4">
                
                <span class='mb-2'>Montant à payer: </span>
                <h3>
                    <span id="card-price">{{ total }}</span>
                    €
                </h3>  

                <span>Frais de livraison</span> 
                <h3>
                    <span id="shippingCost"></span>
                    €
                </h3>

                <span>Montant total de livraison</span> 
                <h3>
                    <span class="total_Price"></span>
                    €
                </h3>  
            </div> 
        </div>
    </div> 
</div>
<script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo="crossorigin="anonymous">
</script>
<script>

    $(document).ready(function(){
        
        const citySelector = $('#order_city');
        const cityValue = citySelector.val();
        const url = `http://localhost:8000/city/${cityValue}/shipping/cost`;

        function ajaxRequest(url) {
            $.ajax({
                url: url,
                type: 'GET',
                success: function(response) {
                    const newResponse = JSON.parse(response)
                    if (parseInt(newResponse.status) === 200){
                        console.log(newResponse.status);
                        $("#shippingCost").text(newResponse.content);

                        const cardPrice = parseInt($("#card-price").text());
                        //console.log(cardPrice);

                        const shippingCost = parseInt($('#shippingCost').text());
                        //console.log(shippingCost);

                        $('.total_Price').text(cardPrice + shippingCost);
                    }
                },
                error:function(xhr,status,error){

                }
            })  
        } 
        ajaxRequest(url)
            
        citySelector.on('change',function() {
            const urlUpdate = `http://localhost:8000/city/${$(this).val()}/shipping/cost`;
            //alert(urlUpdate)
            ajaxRequest(urlUpdate)
        })
    })

</script>

{% endblock %}
